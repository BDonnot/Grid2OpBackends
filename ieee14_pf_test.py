import ssl
import os
from pathlib import Path
import pandas as pd
from gridcalBackend import GridCalBackend

ssl._create_default_https_context = ssl._create_unverified_context
pd.options.display.float_format = "{:,.4f}".format

folder = os.path.join(Path.home(), 'data_grid2op', 'l2rpn_case14_sandbox')
fname = os.path.join(folder, 'grid.json')

backend = GridCalBackend()

backend.load_grid(filename=fname)

backend.runpf(is_dc=False)

print(backend.results.get_bus_df())
print()
print(backend.results.get_branch_df())

'''
	V: Voltage module
BUS 1	1.06
BUS 2	1.045
BUS 3	1.01
BUS 4	1.0176708575899434
BUS 5	1.019513863851402
BUS 6	1.07
BUS 7	1.0615195376963784
BUS 8	1.09
BUS 9	1.055931726372385
BUS 10	1.0509846305424135
BUS 11	1.0569065225344056
BUS 12	1.055188564227829
BUS 13	1.0503817153554087
BUS 14	1.0355299507009856


Pf:
	"Pf: Active power ""from"""
1_BUS1_138.0_2_BUS2_138.0_1	156.88288652036925
1_BUS1_138.0_5_BUS5_138.0_1	75.5103798243807
2_BUS2_138.0_3_BUS3_138.0_1	73.23757808601918
2_BUS2_138.0_4_BUS4_138.0_1	56.131494566682825
2_BUS2_138.0_5_BUS5_138.0_1	41.51621353697664
3_BUS3_138.0_4_BUS4_138.0_1	-23.285690627257555
4_BUS4_138.0_5_BUS5_138.0_1	-61.1582310835181
6_BUS6_138.0_11_BUS11_138.0_1	7.35327693069763
6_BUS6_138.0_12_BUS12_138.0_1	7.786066878557644
6_BUS6_138.0_13_BUS13_138.0_1	17.747976715831275
7_BUS7_138.0_8_BUS8_138.0_1	2.220446049250313e-14
7_BUS7_138.0_9_BUS9_138.0_1	28.07417855964908
9_BUS9_138.0_10_BUS10_138.0_1	5.22755058212662
9_BUS9_138.0_14_BUS14_138.0_1	9.426380301361997
10_BUS10_138.0_11_BUS11_138.0_1	-3.785324268691888
12_BUS12_138.0_13_BUS13_138.0_1	1.6142577197020287
13_BUS13_138.0_14_BUS14_138.0_1	5.643851754825284
4_BUS4_138.0_7_BUS7_138.0_1	28.0741764548519
4_BUS4_138.0_9_BUS9_138.0_1	16.079758301762638
5_BUS5_138.0_6_BUS6_138.0_1	44.08731875605599

'''